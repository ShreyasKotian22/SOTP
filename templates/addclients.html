<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Client Management</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://fonts.cdnfonts.com/css/sf-pro-display" rel="stylesheet">
  <style>
    

html, body {
      height: 100%;
      overflow: visible !important;
    }
    body { 
      margin: 0;
      padding: 0;
      font-family: SF Pro Display, sans-serif;
      overflow: hidden !important;
    }
    * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: SF Pro Display, sans-serif;
  
}

/* Container Layout */
.container {
  display: flex;
  width: 100%;
  height: 100vh;
  overflow: hidden !important;
}

/* Sidebar */
.sidebar {
  width: 280px;
  background-color: #006D7D;
  color: white;
  display: flex;
  flex-direction: column;
  padding: 20px 0;
}

.sidebar .logo img {
  width: 245px;
  margin: 0 auto 20px;
  display: block;
}

.sidebar nav ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.sidebar nav ul li {
  padding: 12px 30px;
  cursor: pointer;
  font-size: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: background 0.3s;
}

    .nav-item i,
.logout i {
  font-size: 18px;
}

.nav-item:hover {
  background-color: rgba(255, 255, 255, 0.356);
  cursor: pointer;
}


.logout {
  padding: 12px 30px;
  cursor: pointer;
  font-size: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: auto;
}

/* Main content */
.main-content {

  flex: 1;
  padding: 30px 40px;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  opacity: 0;
  animation: fadeIn 1.2s ease-out forwards;
}

/* Pop animation for error message */
@keyframes popError {
  0% { transform: scale(0.8); opacity: 0; }
  60% { transform: scale(1.1); opacity: 1; }
  100% { transform: scale(1); opacity: 1; }
}
.error-message {
  display: block;           /* Always block, not none/inline */
  min-height: 18px;         /* Reserve space even when empty */
  color: red;
  font-size: 13px;
  margin-top: 2px;
  margin-bottom: 6px;       /* Add space below error */
  animation: popError 0.25s;
}

@keyframes fadeIn {
  to {
    opacity: 1;
  }
}

.main-content h1 {
  font-size: 24px;
  font-family: 'SF Pro Display', sans-serif;
  font-weight: 700;
  margin-bottom: 25px;
  text-align: left;
}

/* Greeting section */
.greeting {
  margin-bottom: 25px;
}

.greeting h1 {
  font-size: 26px;
  color: #111;
  margin-bottom: 4px;
}

.greeting p {
  font-size: 15px;
  color: #666;
  margin-bottom: 30px;
}

/* Dashboard stat cards */
.cards-dashboard {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  margin-top: -39px; /* ‚¨ÖÔ∏è Moves cards closer to greeting */
  margin-bottom: 20px;
}

.card-dashboard {
  background: #ffffff;
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 16px 24px;
  border-radius: 12px;
  box-shadow: 2px 4px 10px rgba(0, 0, 0, 0.1);
  min-width: 200px;
  max-width: 220px;
  height: 80px;
}

.card-icon {
  background-color: #127285;
  color: white;
  padding: 12px;
  border-radius: 8px;
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 40px;
  height: 40px;
}

.card-label {
  font-size: 13px;
  font-weight: 600;
  color: #444;
}

.card-value {
  font-size: 18px;
  font-weight: bold;
  color: #111;
}

/* Dashboard stat cards */
.cards-dashboard {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  margin-top: -39px;
  margin-bottom: 20px;
}

.card-dashboard {
  background: #ffffff;
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 16px 24px;
  border-radius: 12px;
  box-shadow: 2px 4px 10px rgba(0, 0, 0, 0.1);
  min-width: 200px;
  max-width: 220px;
  height: 80px;
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.card-dashboard:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
}

/* Icon */
.card-icon {
  background-color: #127285;
  color: white;
  padding: 12px;
  border-radius: 8px;
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: 40px;
  height: 40px;
}

/* Text */
.card-label {
  font-size: 13px;
  font-weight: 600;
  color: #444;
}

.card-value {
  font-size: 18px;
  font-weight: bold;
  color: #111;
}


/* Chart section */
.chart-section {
  background-color: white;
  padding: 24px;
  border-radius: 15px;
  box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.08);
  width: 88%;
  max-width: 100%;
  margin: 0 0 20px 30px; /* Moved left */
  box-sizing: border-box;
}

.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  margin-bottom: 20px;
}

.chart-header h2 {
  font-size: 20px;
  font-family: 'SF Pro Display', sans-serif;
  font-weight: 700;
}

/* Filters */
.filters {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
}

.filters select {
  padding: 6px 12px;
  border-radius: 6px;
  border: 1px solid #ccc;
  background-color: #127285;
  color: white;
  font-weight: 600;
  cursor: pointer;
}

.chart-placeholder {
  margin-top: 20px;
  height: 198px;
  display: flex;
  justify-content: flex-start; /* Align left */
  align-items: center;
  color: #888;
  font-style: italic;
  border: 1px dashed #ccc;
  border-radius: 10px;
  padding-left: 20px; /* Optional spacing */
}

#performanceChart {
  margin-top: 10px;
  max-height: 350px;
}


.nav-item i,
.logout i {
  font-size: 18px;
  margin-right: 8px; /* spacing between icon and text */
  vertical-align: middle;
  width: 18px;        /* uniform width */
  height: 22px;       /* uniform height */
  display: inline-block;
}
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
    }

    body {
      display: flex;
      background-color: #f5f6f8;
      height: 100vh;
      overflow: visible !important;
    }

    .container {
      display: flex;
      width: 100%;
    }

    .sidebar {
      width: 280px;
      background-color: #006D7D;
      color: white;
      display: flex;
      flex-direction: column;
      padding: 20px 0;
    }

    .sidebar .logo img {
      width: 245px;
      margin: 0 auto 20px;
      display: block;
    }

    .sidebar nav ul li:hover {
      background-color: rgba(255, 255, 255, 0.356);
    }

    .main-content {
      flex: 1;
      padding: 30px 40px;
      overflow: hidden;
      opacity: 0;
  animation: fadeIn 1.2s ease-out forwards;
    }

    @keyframes fadeIn {
  to {
    opacity: 1;
  }
}
    .main-content h1 {
      font-size: 24px;
      font-weight: 700;
      color: #111;
      margin-bottom: 25px;
    }

    .actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-bottom: 20px;
    }

    .btn {
      background-color: #006D7D;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      height: 35px;
    }

.table-scroll-container {
  border-radius: 8px;
  background: white;
  box-shadow: 0 0 4px rgba(0,0,0,0.1);
  margin-bottom: 2px;
  overflow: hidden;
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

.table-scroll-inner {
  overflow-y: auto;
  overflow-x: auto;
  max-height: 410px;
  width: 100%;
  border-radius: 8px;
  min-height: 0;
}


/* Hide default scrollbar if desired (remove if you want visible scrollbar) */
.table-scroll-inner::-webkit-scrollbar {
  width: 15px;               /* Adjust thickness */
  background-color: #f0f0f0; /* Background track color */
}

.table-scroll-inner::-webkit-scrollbar-track {
  background-color: #f0f0f0; /* Track background */
  border-radius: 10px;       /* Optional: track corners */
  box-shadow: inset 0 0 3px rgba(0,0,0,0.1); /* Optional: subtle inner shadow */
  
}

.table-scroll-inner::-webkit-scrollbar-thumb {
  background-color: #888;    /* Scrollbar thumb color */
  border-radius: 10px;       /* Rounded corners */
  border: 3px solid #f0f0f0; /* Creates padding inside the track */
}
.table-scroll-inner::-webkit-scrollbar-button:single-button:decrement {
  background-color: #f0f0f0;
  height: 16px;
  display: block;
  border-radius: 10px 10px 0 0;
  background-image: url("data:image/svg+xml;utf8,<svg fill='gray' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 320 512'><path d='M160 192L32 320h256L160 192z'/></svg>");
  background-repeat: no-repeat;
  background-position: center;
}

/* Bottom arrow button */
.table-scroll-inner::-webkit-scrollbar-button:single-button:increment {
  background-color: #f0f0f0;
  height: 16px;
  display: block;
  border-radius: 0 0 10px 10px;
  background-image: url("data:image/svg+xml;utf8,<svg fill='gray' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 320 512'><path d='M160 320l128-128H32l128 128z'/></svg>");
  background-repeat: no-repeat;
  background-position: center;
}
/* Table Styling */
.table-wrapper {
  min-width: 100%;
  background-color: white;
   width: max-content; /* ‚úÖ Forces table to retain width even if content shrinks */
}

.table-wrapper table {
  width: 100%;
  border-collapse: collapse;
  min-width: 800px;
  border-radius: 8px;
  overflow: hidden;
}

.table-wrapper thead th {
  position: sticky;
  top: 0;
  background-color: #006D7D;
  color: white;
  z-index: 1;
}

.table-wrapper th,
.table-wrapper td {
  padding: 12px;
  font-size: 14px;
  text-align: center;
  white-space: nowrap;
}

.table-wrapper tbody tr:nth-child(odd) {
  background-color: #CDE6EA;
}

.table-wrapper tbody tr:nth-child(even) {
  background-color: #E0F1F5;
}

    table {
      width: 100%;
      border-collapse: collapse;
    
    }

    th, td {
      padding: 12px;
      font-size: 14px;
      text-align: center;
      
    }

    thead {
      background-color: #006D7D;
      color: white;
    }

    tbody tr:nth-child(odd) {
      background-color: #CDE6EA;
    }

    tbody tr:nth-child(even) {
      background-color: #E0F1F5;
    }

    .action-icons {
      display: flex;
      gap: 12px;
      justify-content: center;
      align-items: center;
    }

    .edit-icon {
      color: #007bff;
      cursor: pointer;
    }

    .delete-icon {
      color: #dc3545;
      cursor: pointer;
    }

    .form-card {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.08);
      max-width: 800px;
      margin-top: 20px;
      margin-left: 20px;
    
    }

    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 15px;
      height: 50px;
    }

    .form-row input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .form-group textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      resize: vertical;
    }

    .form-group label,
    .form-row label {
      font-weight: 500;
      display: block;
      margin-bottom: 5px;
    }

    .form-actions {
      text-align: right;
      margin-top: 20px;
    }

    .form-actions button {
      padding: 8px 20px;
      border: 1px solid #999;
      border-radius: 6px;
      background: transparent;
      cursor: pointer;
    }

    @media(max-width: 768px) {
      .form-row {
        flex-direction: column;
      }
    }
     html, body {
      height: 100%;
      overflow: visible !important;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      overflow: visible !important;
    }
    * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

body {
  display: flex;
  background-color: #f5f6f8;
  height: 100vh;
  overflow: visible !important;
}

/* Container Layout */
.container {
  display: flex;
  width: 100%;
  height: 100vh;
  
}

/* Sidebar */
.sidebar {
  width: 280px;
  background-color: #127285;
  color: white;
  display: flex;
  flex-direction: column;
  padding: 20px 0;
}

.sidebar .logo img {
  width: 245px;
  margin: 0 auto 20px;
  display: block;
}

.sidebar nav ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.sidebar nav ul li {
  padding: 12px 30px;
  cursor: pointer;
  font-size: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: background 0.3s;
}

    .nav-item i,
.logout i {
  font-size: 18px;
}

.nav-item:hover {
  background-color: rgba(255, 255, 255, 0.356);
  cursor: pointer;
}

.logout {
  padding: 12px 30px;
  cursor: pointer;
  font-size: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: auto;
}
.nav-item.active {
  background-color: rgba(255, 255, 255, 0.25); /* subtle highlight */
}

.back-heading {
  text-decoration: none;
  color: inherit;
}

.back-heading h1 {
  margin: 0;
  transition: color 0.2s ease;
}

.back-heading:hover h1 {
  color: #127285;
  cursor: pointer;
  transform: translateX(-2px);
}
.modal {
  position: fixed;
  z-index: 999;
  left: 0; top: 0; right: 0; bottom: 0;
  background-color: rgba(0,0,0,0.5);
  display: flex;
  justify-content: center;
  align-items: center;
}

.modal-content {
  background-color: white;
  padding: 30px;
  border-radius: 8px;
  width: 400px;
  max-width: 90%;
  box-shadow: 0px 4px 10px rgba(0,0,0,0.2);
}

.modal-content h3 {
  margin-top: 0;
  margin-bottom: 20px;
}

.modal-content input,
.modal-content textarea {
  width: 100%;
  padding: 8px 10px;
  margin-bottom: 12px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}
#editModal.modall-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: rgba(0, 0, 0, 0.3);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
}

#editModal .modal-content {
  position: relative;
  background: #fff;
  border-radius: 14px;
  padding: 32px 40px 28px;
  width: 480px;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
  font-family: 'Inter', sans-serif;
}

#editModal .modal-body h3 {
  margin-top: 0;
  margin-bottom: 20px;
  font-weight: 600;
  font-size: 16px;
  text-align: center;
  color: #000;
}

#editModal .modal-body label {
  display: block;
  font-size: 14px;
  font-weight: 500;
  margin-top: 14px;
  margin-bottom: 6px;
  color: #333;
}

#editModal .modal-body input {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 14px;
  background: #f9f9f9;
}

#editModal .modal-footer {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 28px;
}

#editModal .save-btn,
#editModal .cancel-btn {
  padding: 10px 24px;
  font-size: 14px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.2s ease-in-out;
}

#editModal .save-btn {
  background-color: #127285;
  color: white;
}

#editModal .save-btn:hover {
 
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

#editModal .cancel-btn {
  background-color: #e0e0e0;
  color: #333;
}

#editModal .cancel-btn:hover {
  background-color: #ccc;
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Pen Icon Circle Above Modal */
#editModal .modal-header {
 position: absolute;
  top: -32px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #127285;
  width: 64px;
  height: 64px;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
}

#editModal .modal-icon {
  color: #fff;
  font-size: 24px;
}

#editModal .form-row {
  display: flex;
  gap: 20px;
  margin-bottom: 14px;
}

#editModal .form-group {
  flex: 1;
}

#editModal .form-group label {
  margin-top: 0;
}
.delete-modal-overlay {
  position: fixed;
  z-index: 1000;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.3);
  display: flex;
  align-items: center;
  justify-content: center;
}

.delete-modal-box {
  background: #fff;
  width: 400px;
  padding: 25px;
  border-radius: 10px;
  text-align: center;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
  position: relative;
}

.delete-icon-container {
  background-color: #ff6b5b;
  color: white;
  border-radius: 50%;
  width: 70px;
  height: 70px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-top: -60px;
  margin-bottom: 20px;
  font-size: 30px;
}  

.delete-modal-body h2 {
  margin-bottom: 15px;
  font-weight: 600;
}

.delete-modal-body p {
  margin: 5px 0;
  font-size: 14px;
  color: #333;
}

.delete-modal-actions {
  margin-top: 25px;
  display: flex;
  justify-content: center;
  gap: 20px;
}

.cancel-btn, .delete-btn {
  padding: 10px 25px;
  border: none;
  border-radius: 5px;
  font-weight: 600;
  cursor: pointer;
  font-size: 14px;
}

.cancel-btn {
  background-color: #fff;
  border: 1.5px solid #ccc;
  color: #333;
}
.cancel-btn:hover{
    transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}
.delete-btn {
  background-color: #ff6b5b;
  color: white;
}
.delete-btn:hover{
    transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}
.filter-icon {
  cursor: pointer;
  margin-left: 5px;
}

 .filter-dropdown {
  position: absolute;
  display: none;
  top: auto; /* Ensures dropdown appears below the header */
  left: 0;
  background-color: white;
  z-index: 99999;
  padding: 10px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  min-width: 200px;
  max-height: 300px;
  border-radius: 6px;
  border: 1px solid #ccc;
}
.filter-dropdown {
  position: fixed; /* Change from absolute to fixed */
   top: auto !important; 
  left: auto !important;
  transform: translate(10px, 12px); /* Adjust as per visual offset */
  background-color: white;
  z-index: 99999; /* Ensure it appears on top */
  padding: 10px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  min-width: 200px;
  max-height: 300px;
  border-radius: 6px;
  border: 1px solid #ccc;
}


#clients, table{
  width: 100%;
  border-collapse: collapse;
  border-radius: 8px;
  /* overflow: hidden; */
}


.filter-dropdown input {
   width: 100%;
  padding: 6px;
  margin-bottom: 8px;
  box-sizing: border-box;
  border: 1px solid #ccc;
  border-radius: 4px;
}
.filter-dropdown label {
  display: block;
  font-size: 14px;
  margin-bottom: 4px;
}

.checkbox-list {
  text-align: left;
  max-height: 160px;
  overflow-y: auto;
  overflow-x: hidden; /* Hide horizontal scroll */
  padding-left: 4px;
}

/* .global-column-dropdown {
  position: absolute;
  z-index: 9999;
  background: white;
  border: 1px solid #ccc;
  padding: 8px;
  max-height: 250px;
  overflow-y: auto;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  top: 100%;
} */

.checkbox-list label {
  display: flex;
  align-items: flex-start;       /* Align checkbox with top of text */
  gap: 4px;                      /* Small space between checkbox and text */
  font-size: 14px;
  font-weight: normal;
  color: #333;
  margin-bottom: 6px;
  cursor: pointer;
  white-space: normal;           /* Allow wrapping */
  word-break: break-word;        /* Handle long words */
  line-height: 1.3;
}

.checkbox-list input[type="checkbox"] {
  margin-top: 2px;              /* Align with first line of text */
  flex-shrink: 0;               /* Prevent checkbox from shrinking */
  width: 14px;
  height: 14px;
}

.btn-download {
  background-color: #007980;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: background-color 0.3s ease;
}

.btn-download:hover {
  background-color: #006067;
}


/* sort drop */
.sort-field-dropdown .sort-field-option:hover {
  background: #f0f0f0;
}

.filter-active {
  background-color: #ffe082 !important; /* yellow highlight, adjust as needed */
  color: #333 !important;
}
.overlay-success {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: rgba(0,0,0,0.4);
  z-index: 10000;
  display: flex;
  justify-content: center;
  align-items: center;
}

.success-card {
  background: #fff;
  padding: 32px;
  border-radius: 16px;
  text-align: center;
  box-shadow: 0 6px 20px rgba(0,0,0,0.2);
  max-height: 300px;
  height: 100%;;
  max-width: 600px;
  width: 100%;
  animation: fadeInScale 0.3s ease-out;
}

.success-card h2 {
  margin-bottom: 20px;
  font-size: 20px;
  color: #077c24;
}

.success-actions {
  display: flex;
  gap: 30px;
  justify-content: center;
  margin-top: 16px;
}

.btn-success {
  background-color: #127285;
  color: white;
  padding: 10px 20px;
  border-radius: 8px;
  border: none;
  font-weight: 600;
  cursor: pointer;
}

.btn-outline {
  background: white;
  color: #127285;
  border: 2px solid #127285;
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
}

@keyframes fadeInScale {
  0% { transform: scale(0.9); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}
.success-icon {
  color: #2ecc71; /* green */
  font-size: 60px;
  margin-bottom: 16px;
}
.success-id-label {
  font-size: 20px;
  color: #000000;
  margin-bottom: 10px;
  font-weight: 500;
}
.delete-modal-overlay {
  position: fixed;
  z-index: 1000;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.3);
  display: flex;
  align-items: center;
  justify-content: center;
}

.delete-modal-box {
  position: relative;
  width: 460px;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 6px 30px rgba(0, 0, 0, 0.15);
  padding: 40px 30px 25px 30px;
  text-align: center;
  font-family: 'SF Pro Display', sans-serif;
}

.delete-icon-container {
  position: absolute;
  top: -35px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #ff6b5b;
  color: white;
  border-radius: 50%;
  width: 70px;
  height: 70px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  border: 5px solid white;
}

.delete-modal-body h2 {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 25px;
}

.delete-details-table {
  margin: 0 auto;
  text-align: left;
  font-size: 15px;
  font-weight: 500;
}

.delete-details-table td {
  padding: 4px 8px;
}

.delete-modal-actions {
  margin-top: 30px;
  display: flex;
  justify-content: center;
  gap: 20px;
}

.cancel-btn, .delete-btn {
  padding: 10px 25px;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  font-size: 14px;
}

.cancel-btn {
  background: white;
  border: 1px solid #999;
  color: #333;
}

.delete-btn {
  background-color: #ff6b5b;
  color: white;
  border: none;
}

.delete-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}


.delete-modal-overlay {
  position: fixed;
  z-index: 1000;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.3);
  display: flex;
  align-items: center;
  justify-content: center;
}

.delete-modal-box {
  position: relative;
  width: 460px;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 6px 30px rgba(0, 0, 0, 0.15);
  padding: 40px 30px 25px 30px;
  text-align: center;
  font-family: 'SF Pro Display', sans-serif;
}

.delete-icon-container {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #ff6b5b;
  color: white;
  border-radius: 50%;
  width: 70px;
  height: 70px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  border: 5px solid white;
}

.delete-modal-body h2 {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 25px;
}

.delete-details-table {
  margin: 0 auto;
  text-align: left;
  font-size: 15px;
  font-weight: 500;
}

.delete-details-table td {
  padding: 4px 8px;
}

.delete-modal-actions {
  margin-top: 30px;
  display: flex;
  justify-content: center;
  gap: 20px;
}

.cancel-btn,
.delete-btn {
  padding: 10px 25px;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  font-size: 14px;
}

.cancel-btn {
  background: white;
  border: 1px solid #999;
  color: #333;
}

.delete-btn {
  background-color: #ff6b5b;
  color: white;
  border: none;
}

.delete-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}
.has-submenu {
  position: relative;
}

.has-submenu .submenu {
  display: none;
  list-style: none;
  background-color: #0a6a7c;
  position: absolute;
  top: 100%;
  left: 0%;
  width: 280px;
  border-radius: 0 0 12px 12px;
  z-index: 999;
  padding: 8px 0;
}

.has-submenu:hover .submenu {
  display: block;
}

.submenu li {
  padding: 0px 30px;
  font-size: 14px;
  color: white;
  cursor: pointer;
   margin-bottom: -7px; /* ‚úÖ Add spacing between items */
}

.submenu li:hover {
  background-color: rgba(255, 255, 255, 0.1);
}
.submenu-arrow {
  margin-left: auto;
}


  </style>
</head>
<body>
  
<!-- =================================================================== -->
<!-- START: New & Improved Sidebar with Bottom-Aligned Support/Logout    -->
<!-- =================================================================== -->
<aside class="sidebar" style="display: flex; flex-direction: column; justify-content: space-between;">
  <!-- Top Navigation Links -->
  <div>
    <div class="logo">
      <img src="{{ url_for('static', filename='assets/LOGO.png') }}" alt="Logo" />
    </div>

    <nav>
      <ul>
        <li class="nav-item">
          <a href="{{ url_for('dashboard') }}" style="color: white; text-decoration: none;">
            <i class="fas fa-th-large"></i> <span> Dashboard</span>
          </a>
        </li>

        <li class="nav-item">
          <a href="/add-order" style="color: white; text-decoration: none;">
            <i class="fas fa-plus-circle"></i> <span> Add New Order</span>
          </a>
        </li>

        <li class="nav-item">
          <a href="{{ url_for('clients') }}" style="color: white; text-decoration: none;">
            <i class="fas fa-user"></i> <span> Clients</span>
          </a>
        </li>

        <li class="nav-item">
          <a href="{{ url_for('view_orders') }}" style="color: white; text-decoration: none;">
            <i class="fas fa-file-alt"></i> <span> View Sales Order</span>
          </a>
        </li>

        <li class="nav-item has-submenu" onclick="toggleSubmenu(this)">
          <div class="report-toggle" style="display: flex; align-items: center; width: 100%; color: white;">
            <i class="fas fa-chart-bar"></i>
            <span style="margin-left: 6px;">Report</span>
            <i class="fas fa-chevron-down submenu-arrow" style="margin-left: auto;"></i>
          </div>
          <ul class="submenu">
            <li onclick="window.location.href='/report'" class="submenu-item active">
              <i class="fas fa-chart-bar"></i>
              <span style="margin-left: 8px;">Sales Order Overview</span>
            </li>
            <li onclick="window.location.href='/po-overview'" class="submenu-item">
              <i class="fas fa-chart-bar"></i>
              <span style="margin-left: 8px;">PO‚Äôs Overview</span>
            </li>
            <li onclick="window.location.href='/growth-overview'" class="submenu-item">
              <i class="fas fa-chart-bar"></i>
              <span style="margin-left: 8px;">Growth Overview</span>
            </li>
          </ul>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Bottom Section: Support + Logout -->
  <div style="display: flex; flex-direction: column;">
    <li class="nav-item" style="list-style: none; flex-direction: column; align-items: flex-start; gap: 8px; padding-left: 26px; margin-bottom: 7px;">
      <a href="mailto:dt@activusdesignbuild.in?subject=Support%20Request"
         style="display: flex; align-items: center; color: white; text-decoration: none;">
        <i class="fas fa-envelope" style="margin-right: 8px;"></i>
        <span>Support</span>
      </a>
      <span style="color: white; font-size: 14px; margin-left: 1px;">dt@activusdesignbuild.in</span>
    </li>

    <li class="nav-item logout">
      <a href="/logout" style="color: white; text-decoration: none;">
        <i class="fas fa-sign-out-alt"></i> <span> Log Out</span>
      </a>
    </li>
  </div>
</aside>



<!-- =================================================================== -->
<!-- END: New & Improved Sidebar                                         -->
<!-- =================================================================== -->


  <!-- Main Content -->
  <main class="main-content">
    <section id="client-list">
    <a href="{{ url_for('dashboard') }}" class="back-heading" style="text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
    <h1><i class="fas fa-th-large"></i> Total Clients</h1>
  </a>

      <div class="actions">
  <button class="btn" onclick="showAddClient()"><i class="fas fa-user-plus"></i> Add Client</button>
  <div class="sort-dropdown-wrapper" style="position: relative;">
    <button class="btn" id="sortToggleBtn" onclick="toggleClientSort(event)">
  ‚ò∞ ‚Äé Sort: <span id="sortOrderLabel">A to Z</span> (<span id="sortFieldLabel">Client Name</span>)
  <span style="margin-left:8px;"><i class="fa fa-chevron-down"></i></span>
</button>
    <div id="sortFieldDropdown" class="sort-field-dropdown" style="display:none; position:absolute; right:0; top:110%; background:white; border:1px solid #ccc; z-index:10; min-width:160px; box-shadow:0 2px 8px rgba(0,0,0,0.12);">
      <div style="padding:8px 0;">
        <div class="sort-field-option" data-value="client_name" style="padding:8px 16px; cursor:pointer;">Personal Name</div>
        <div class="sort-field-option" data-value="company_name" style="padding:8px 16px; cursor:pointer;">Company Name</div>
        <div class="sort-field-option" data-value="email" style="padding:8px 16px; cursor:pointer;">Email</div>
        <div class="sort-field-option" data-value="billing_address" style="padding:8px 16px; cursor:pointer;">Billing Address</div>
        <div class="sort-field-option" data-value="client_id" style="padding:8px 16px; cursor:pointer;">Client ID</div>
      </div>
    </div>
  </div>
  <button class="btn" onclick="location.reload()">üóò ‚Äé Reset Filters</button>
</div>
<div class="table-scroll-container">
  <div class="table-scroll-inner">
      <div class="table-wrapper">

        <table id="clients">
<thead>
  <tr>
    <th>
      Client ID
      <span class="filter-icon" onclick="toggleFilterDropdown(event, 'client_id')">
        <i class="fa fa-chevron-down"></i>
      </span>
      <div class="filter-dropdown" data-column="client_id" onclick="event.stopPropagation()">
        <input type="text" placeholder="Search..." oninput="filterOptions(this)">
        <div class="checkbox-list" id="filter-client_id"></div>
      </div>
    </th>
    <th>
      Company Name
      <span class="filter-icon" onclick="toggleFilterDropdown(event, 'company_name')">
        <i class="fa fa-chevron-down"></i>
      </span>
      <div class="filter-dropdown" data-column="company_name" onclick="event.stopPropagation()">
        <input type="text" placeholder="Search..." oninput="filterOptions(this)">
        <div class="checkbox-list" id="filter-company_name"></div>
      </div>
    </th>
    <th>
      Personal Name
      <span class="filter-icon" onclick="toggleFilterDropdown(event, 'client_name')">
        <i class="fa fa-chevron-down"></i>
      </span>
      <div class="filter-dropdown" data-column="client_name" onclick="event.stopPropagation()">
        <input type="text" placeholder="Search..." oninput="filterOptions(this)">
        <div class="checkbox-list" id="filter-client_name"></div>
      </div>
    </th>
    <th>
      Email
      <span class="filter-icon" onclick="toggleFilterDropdown(event, 'email')">
        <i class="fa fa-chevron-down"></i>
      </span>
      <div class="filter-dropdown" data-column="email" onclick="event.stopPropagation()">
        <input type="text" placeholder="Search..." oninput="filterOptions(this)">
        <div class="checkbox-list" id="filter-email"></div>
      </div>
    </th>
    <th>
      Phone
      <span class="filter-icon" onclick="toggleFilterDropdown(event, 'phone')">
        <i class="fa fa-chevron-down"></i>
      </span>
      <div class="filter-dropdown" data-column="phone" onclick="event.stopPropagation()">
        <input type="text" placeholder="Search..." oninput="filterOptions(this)">
        <div class="checkbox-list" id="filter-phone"></div>
      </div>
    </th>
    <th>
      Billing Address
      <span class="filter-icon" onclick="toggleFilterDropdown(event, 'billing_address')">
        <i class="fa fa-chevron-down"></i>
      </span>
      <div class="filter-dropdown" data-column="billing_address" onclick="event.stopPropagation()">
        <input type="text" placeholder="Search..." oninput="filterOptions(this)">
        <div class="checkbox-list" id="filter-billing_address"></div>
      </div>
    </th>
    <th>
      GST No
      <span class="filter-icon" onclick="toggleFilterDropdown(event, 'gst_no')">
        <i class="fa fa-chevron-down"></i>
      </span>
      <div class="filter-dropdown" data-column="gst_no" onclick="event.stopPropagation()">
        <input type="text" placeholder="Search..." oninput="filterOptions(this)">
        <div class="checkbox-list" id="filter-gst_no"></div>
      </div>
    </th>
    <th>
      PAN
      <span class="filter-icon" onclick="toggleFilterDropdown(event, 'pan')">
        <i class="fa fa-chevron-down"></i>
      </span>
      <div class="filter-dropdown" data-column="pan" onclick="event.stopPropagation()">
        <input type="text" placeholder="Search..." oninput="filterOptions(this)">
        <div class="checkbox-list" id="filter-pan"></div>
      </div>
    </th>
    <th>Action</th>
  </tr>
</thead>
<tbody>
 {% for client in clients %}
    <tr data-client-id="{{ client[0] }}">
    <td>{{ client[0] }}</td> <!-- Client ID FIRST -->
    <td>{{ client[2] }}</td> <!-- company_name -->
    <td>{{ client[1] }}</td> <!-- client_name -->
    <td>{{ client[3] }}</td> <!-- email -->
    <td>{{ client[4] }}</td> <!-- phone -->
    <td>{{ client[5] }}</td> <!-- billing_address -->
    <td>{{ client[6] }}</td> <!-- gst_no -->
    <td>{{ client[7] }}</td> <!-- pan -->
    <td class="action-icons">
      <i class="fas fa-pen edit-icon" title="Edit" onclick="openEditModal(this)"></i>
      <i class="fas fa-trash delete-icon" title="Delete" onclick="openDeleteModal(this)"></i>
      <i class="fas fa-download" title="Download" onclick="downloadFullClient('{{ client[0] }}')"></i>
    </td>
    
  </tr>
  
 {% endfor %}
</tbody>

        </table>

      </div>
        </div>
</div>
 <div style="display: flex; justify-content: flex-end; margin: 20px 0 40px 0;">
  <button class="btn-download" onclick="exportFilteredClientsToExcel()">
    <i class="fas fa-download"></i> Download 
  </button>
</div>

    </section>
    <section id="add-client" style="display: none;">
       <a href="{{ url_for('dashboard') }}" class="back-heading" style="text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
       <h1><i class="fas fa-th-large"></i> Add New Client</h1>
       </a>
  <div class="form-card">
        <form id="client-form" onsubmit="handleFormSubmit(event)">
      <div class="form-row">
      <div style="flex: 1; display: flex; flex-direction: column; margin-bottom: 12px;">
  <label>Personal Name</label>
  <input type="text" name="client_name" required
    pattern="[A-Za-z ]{2,50}"
    title="Only letters and spaces allowed. 2‚Äì50 characters."
    oninput="filterClientNameInput(this); validateField(this)">
  <span class="error-message" id="client_name_error"></span>
</div>


        <div style="flex: 1;">
  <label>Company Name</label>
  <input type="text" name="company_name" id="companyInput" required
    list="companyNameList"
    pattern="[A-Za-z0-9 .,/\-&()\[\]:;']{2,50}"
    title="Only letters, numbers, spaces, and . , / - & ( ) [ ] : ; ' allowed. 1‚Äì100 characters.">
  <datalist id="companyNameList"></datalist>
</div>
      </div>
      <div class="form-row">
        <div style="flex: 1;">
          <label>Email</label>
              <input type="email" name="email" required
              oninput="validateField(this)">
        </div>
        <div style="flex: 1;">
          <label>Phone</label>
              <input type="text" name="phone" required
              oninput="validateField(this)"
              pattern="[0-9]{10}" maxlength="10"
              title="Enter a valid 10-digit phone number">

        </div>
      </div>
          <div class="form-group" style="margin-bottom: 15px;">
        <label>Billing Address</label>
        <textarea rows="3" name="billing_address" required></textarea>
      </div>


          <!-- GST and PAN Number side-by-side -->
<div class="form-row" style="margin-bottom: 15px; display: flex; gap: 10px;">
  <div style="flex: 1;">
    <label>GST No</label>
    <input type="text" name="gst_no" required
    oninput="validateField(this)"
     pattern="\d{2}[A-Z]{5}\d{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}"
     title="Enter valid GST No (e.g., 22AAAAA0000A1Z5)"
    style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid #ccc; border-radius: 5px;"/>
    <span class="error-message" id="client_name_error" style="color: red; font-size: 13px;"></span>
    
  </div>
  <div style="flex: 1;">
    <label>PAN Number</label>
    <input type="text" name="pan" required 
    oninput="validateField(this)"
    pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" maxlength="10"
    title="Enter valid PAN (e.g., ABCDE1234F)"
    style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid #ccc; border-radius: 5px;"
    />
  </div>
</div>
        
<div class="form-actions">
            <button type="button" onclick="window.location.href='/clients'">Cancel</button>
            <button type="submit" style="margin-left: 10px; background-color: #006D7D; color: white; border: none;">Save</button>
</div>
          <p id="success-message" style="
  margin-top: 15px;
  color: green;
  font-weight: 600;
  display: none;
  width: fit-content;
  margin-left: auto;
  margin-right: auto;
">
  Client Added Successfully!
</p>
        </form>
      </div>
    </section>
  </main>
</div>


<script>

let sortClientAZ = true; // default: A to Z
let sortField = "client_name"; // default sort field


function toggleFilterDropdown(event, column) {
  event.stopPropagation();
  const dropdown = document.querySelector(`.filter-dropdown[data-column="${column}"]`);
  dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
}


function validateField(input) {
  const patternAttr = input.getAttribute('pattern');
  const errorSpan = document.getElementById((input.id || input.name) + '_error');
  const value = input.value.trim();

  if (!patternAttr || !errorSpan) return;

  const pattern = new RegExp("^" + patternAttr + "$");

  if (!value) {
    errorSpan.textContent = "This field is required.";
    errorSpan.style.display = "block";
    errorSpan.style.animation = "popError 0.25s";
    input.setCustomValidity("This field is required.");
  } else if (!pattern.test(value)) {
    errorSpan.textContent = input.title || "Invalid input.";
    errorSpan.style.display = "block";
    errorSpan.style.animation = "popError 0.25s";
    input.setCustomValidity("Invalid input.");
  } else {
    errorSpan.textContent = "";
    errorSpan.style.display = "none";
    input.setCustomValidity("");
  }
}
 
/* ADD CLIENT */
  function showAddClient() {
    document.getElementById("client-list").style.display = "none";
    document.getElementById("add-client").style.display = "block";
    document.getElementById("filter-section").style.display = "none";
  }

 window.addEventListener("DOMContentLoaded", function () {
    const target = window.location.hash;
    if (target === "#add-client") {
      // Show the Add Client form
      const addSection = document.getElementById("add-client");
      const listSection = document.getElementById("client-list");
      if (addSection && listSection) {
        listSection.style.display = "none";
        addSection.style.display = "block";
        addSection.scrollIntoView({ behavior: "smooth" });
      }
    }
  });


  function showClientList() {
    document.getElementById("add-client").style.display = "none";
    document.getElementById("client-list").style.display = "block";
    document.getElementById("filter-section").style.display = "none";
}


function handleFormSubmit(event) {
  event.preventDefault();

  const form = document.getElementById("client-form");
  const formData = new FormData(form);
  const payload = {};

  formData.forEach((value, key) => {
    payload[key] = value;
  });

  fetch('/add-client', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(data => {
    // üîÅ If email already exists
    if (data.duplicate) {
      document.getElementById("duplicateOverlay").style.display = "flex";
      return;
    }

    // ‚úÖ If client was successfully added
    if (data.message) {
      document.getElementById("successOverlay").style.display = "flex";
      document.getElementById("success-client-id").textContent = data.client_id;

      const newRow = document.createElement('tr');
      newRow.setAttribute('data-client-id', data.client_id);

      newRow.innerHTML = `
        <td>${payload.company_name}</td>
        <td>${payload.client_name}</td>
        <td>${payload.email}</td>
        <td>${payload.phone}</td>
        <td>${payload.billing_address}</td>
        <td>${payload.gst_no}</td>
        <td>${payload.pan}</td>
        <td>${data.client_id}</td>
        <td class="action-icons">
          <i class="fas fa-pen edit-icon" title="Edit" onclick="openEditModal(this)"></i>
          <i class="fas fa-trash delete-icon" onclick="openDeleteModal(this)"></i>
          <i class="fas fa-download" title="Download" onclick="downloadFullClient('${data.client_id}')"></i>
        </td>
      `;
      document.querySelector("tbody").appendChild(newRow);

      form.reset();
      setTimeout(() => {
        window.location.href = "/clients";
      }, 1000);
    } else {
      alert("Error: " + (data.error || "Unknown error"));
    }
  })
  .catch(err => alert("Server error"));
}


  // Show/Hide filter section

  function closeDuplicateOverlay() {
  document.getElementById("duplicateOverlay").style.display = "none";
  document.getElementById("client-form").scrollIntoView({ behavior: 'smooth' });
}


  function applyFilter() {
    const type = document.getElementById("filter-type").value;
    const query = document.getElementById("filter-input").value.toLowerCase();
    const rows = document.querySelectorAll("tbody tr");

  rows.forEach(row => {
      const companyName = row.children[0].textContent.toLowerCase();
      const clientName = row.children[1].textContent.toLowerCase();

      let match = false;
      if (type === "company") {
        match = companyName.includes(query);
      } else if (type === "client") {
        match = clientName.includes(query);
      }

    row.style.display = match ? "" : "none";
  });
  }

  function clearFilter() {
    document.getElementById("filter-input").value = "";
    applyFilter();
}



function toggleClientSort() {
  sortClientAZ = !sortClientAZ;
  updateSortButtonLabel();
  sortClientTable();
}


function updateSortButtonLabel() {
  const sortBtn = document.getElementById("sortToggleBtn");
  const fieldMap = {
    client_name: "Personal Name",
    company_name: "Company Name",
    email: "Email",
    phone: "Phone",
    billing_address: "Billing Address",
    gst_no: "GST No",
    pan: "PAN",
    client_id: "Client ID"
  };
  sortBtn.innerText = `‚ò∞ ‚Äé Sort: ${sortClientAZ ? "A to Z" : "Z to A"} (${fieldMap[sortField]})`;
}

// Update sort button label
function updateSortButtonLabel() {
  const fieldMap = {
    client_name: "Personal Name",
    company_name: "Company Name",
    email: "Email",
    phone: "Phone",
    billing_address: "Billing Address",
    gst_no: "GST No",
    pan: "PAN",
    client_id: "Client ID"
  };
 if (sortField === "client_id") {
    document.getElementById("sortOrderLabel").innerText = sortClientAZ ? "Lowest to Highest" : "Highest to Lowest";
  } else {
    document.getElementById("sortOrderLabel").innerText = sortClientAZ ? "A to Z" : "Z to A";
  }
  document.getElementById("sortFieldLabel").innerText = fieldMap[sortField];
}


// Toggle sort order (A-Z/Z-A) on button click, open dropdown on arrow click
function toggleClientSort(event) {
  // If the click is on the dropdown arrow, show/hide dropdown
  const arrow = event.target.closest('.fa-chevron-down');
  if (arrow) {
    event.stopPropagation();
    const dropdown = document.getElementById("sortFieldDropdown");
    dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
    return;
  }
  // Otherwise, toggle sort order
  sortClientAZ = !sortClientAZ;
  updateSortButtonLabel();
  sortClientTable();
}


// Show dropdown when clicking the arrow

// Handle dropdown option click
document.querySelectorAll(".sort-field-option").forEach(opt => {
  opt.addEventListener("click", function() {
    sortField = this.getAttribute("data-value");
    updateSortButtonLabel();
    sortClientTable();
    document.getElementById("sortFieldDropdown").style.display = "none";
  });
});

// Hide dropdown when clicking outside
document.addEventListener("click", function(e) {
  const dropdown = document.getElementById("sortFieldDropdown");
  if (dropdown && !dropdown.contains(e.target) && !document.getElementById("sortToggleBtn").contains(e.target)) {
   dropdown.style.display = "none";
  }
});

// Initial label update
updateSortButtonLabel();



/* unction table export to csv */

function exportFilteredClientsToExcel() {
  const table = document.querySelector("#client-list table");
  const rows = Array.from(table.querySelectorAll("tbody tr"));
  // Define headers in the same order as your table
  const headers = [
  "Client ID",
  "Company Name",
  "Client Name",
  "Email",
  "Phone",
  "Billing Address",
  "GST No",
  "PAN"
];

  const data = [];
  data.push(headers);

  // Push visible row data (excluding the action column)
  rows.forEach(row => {
    if (row.style.display === "none") return; // skip hidden rows
    const cells = Array.from(row.querySelectorAll("td")).slice(0, 8); // 8 columns before actions
    const rowData = cells.map(cell => cell.innerText.trim());
    data.push(rowData);
  });

  // Create worksheet and workbook
  const worksheet = XLSX.utils.aoa_to_sheet(data);
  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, "Filtered Clients");

  // Trigger download
  XLSX.writeFile(workbook, "Clients_List.xlsx");
}

function updateFilterHighlights() {
  // For each column, check if any filter is active
  [
    'client_id',
    'company_name',
    'client_name',
    'email',
    'phone',
    'billing_address',
    'gst_no',
    'pan'
  ].forEach(col => {
    const th = document.querySelector(`th:has(.filter-dropdown[data-column="${col}"])`);
    if (!th) return;
    const checked = document.querySelectorAll(`.filter-dropdown[data-column="${col}"] input[type="checkbox"]:checked`);
    // If any filter is checked (and not "Select All"), highlight
    if (checked.length && !(checked.length === 1 && checked[0].id.startsWith('selectAll_'))) {
      th.classList.add('filter-active');
    } else {
      th.classList.remove('filter-active');
    }
  });
}



function sortClientTable() {
  const tbody = document.querySelector("tbody");
  const rows = Array.from(tbody.querySelectorAll("tr"));
  const colIndex = getColIndex(sortField);

  rows.sort((a, b) => {
    let valA = a.children[colIndex].textContent.trim();
    let valB = b.children[colIndex].textContent.trim();

    // If sorting by client_id, sort numerically
    if (sortField === "client_id") {
      valA = parseInt(valA, 10);
      valB = parseInt(valB, 10);
      if (isNaN(valA)) valA = 0;
      if (isNaN(valB)) valB = 0;
      return sortClientAZ ? valA - valB : valB - valA;
    }

    // Otherwise, sort alphabetically
    valA = valA.toLowerCase();
    valB = valB.toLowerCase();
    return sortClientAZ ? valA.localeCompare(valB) : valB.localeCompare(valA);
  });

  rows.forEach(row => tbody.appendChild(row));
}

sortClientTable(); // Initial sort

  

function openEditModal(element) {
  const row = element.closest("tr");

  document.getElementById("editOrderId").value = row.getAttribute("data-client-id");
  document.getElementById("editCompany").value = row.children[1].textContent.trim(); // Company Name is now 1
  document.getElementById("editClient").value = row.children[2].textContent.trim();  // Client Name is now 2
  document.getElementById("editEmail").value = row.children[3].textContent.trim();
  document.getElementById("editPhone").value = row.children[4].textContent.trim();
  document.getElementById("editBillingAddress").value = row.children[5].textContent.trim();
  document.getElementById("editGST").value = row.children[6].textContent.trim();
  document.getElementById("editPAN").value = row.children[7].textContent.trim();

  document.getElementById("editModal").style.display = "flex";
}

function closeEditModal() {
  document.getElementById("editModal").style.display = "none";
}


function submitEdit(event) {
  event.preventDefault();
  
const form = document.getElementById("editForm");
if (!form.checkValidity()) {
  form.reportValidity();
  return;
}
  // ‚úÖ Collect form values
    const clientId = document.getElementById("editOrderId").value.trim();
  const companyName = document.getElementById("editCompany").value.trim();
  const clientName = document.getElementById("editClient").value.trim();
  const email = document.getElementById("editEmail").value.trim();
  const phone = document.getElementById("editPhone").value.trim();
  const gstNo = document.getElementById("editGST").value.trim();
  const pan = document.getElementById("editPAN").value.trim();
  const billingAddress = document.getElementById("editBillingAddress").value.trim();

  // ‚úÖ Make PUT request
  fetch("/update-client", {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      client_id: clientId,
      company_name: companyName,
      client_name: clientName,
      email: email,
      phone: phone,
      gst_no: gstNo,
      pan: pan,
      billing_address: billingAddress
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      closeEditModal();
      location.reload();
    } else {
      alert("Update failed: " + data.error);
    }
  })
  .catch(err => {
    alert("Server error: " + err);
  });
}





function downloadFullClient(clientId) {
  fetch(`/download-client/${clientId}`)
    .then(response => response.blob())
    .then(blob => {
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `Client_${clientId}_Details.xlsx`;
      document.body.appendChild(a);
      a.click();
      a.remove();
    })
    .catch(err => {
      alert("Download failed: " + err);
    });
}
const columnFilters = {}; // Store selected filters per column

function toggleFilterDropdown(event, column) {
  closeAllDropdowns();

  const dropdown = event.target.closest("th").querySelector(".filter-dropdown");
  if (dropdown) {
    populateCheckboxOptions(column, dropdown); // <-- use this!
    dropdown.style.display = "block";
    event.stopPropagation();
  }
}

function closeAllDropdowns() {
  document.querySelectorAll(".filter-dropdown").forEach(dropdown => {
    dropdown.style.display = "none";
  });
}

document.body.addEventListener("click", closeAllDropdowns);

function populateDropdownOptions(column, dropdown) {
  const rows = document.querySelectorAll("tbody tr");
  const values = new Set();

  rows.forEach(row => {
    const columnIndex = getColumnIndex(column);
    if (columnIndex !== -1) {
      const value = row.children[columnIndex].textContent.trim();
      values.add(value);
    }
  });

  const checkboxList = dropdown.querySelector(".checkbox-list");
  checkboxList.innerHTML = "";

  [...values].sort().forEach(val => {
    const id = `${column}_${val.replace(/\s+/g, "_")}`;
    checkboxList.innerHTML += `
      <label><input type="checkbox" value="${val}" id="${id}"> ${val}</label>
    `;
  });

  // Pre-check selected filters
  if (columnFilters[column]) {
    columnFilters[column].forEach(val => {
      const box = checkboxList.querySelector(`input[value="${val}"]`);
      if (box) box.checked = true;
    });
  }
}


function getColumnIndex(columnName) {
  const map = {
    "client_id": 0,
    "company_name": 1,
    "client_name": 2,
    "email": 3,
    "phone": 4,
    "billing_address": 5,
    "gst_no": 6,
    "pan": 7
  };
  return map[columnName];
}

function applyColumnFilter(column) {
  const dropdown = document.querySelector(`.filter-dropdown[data-column="${column}"]`);
  const checkboxes = dropdown.querySelectorAll("input[type='checkbox']:checked");
  const selected = Array.from(checkboxes).map(cb => cb.value);

  columnFilters[column] = selected;
  filterTable();
  dropdown.style.display = "none";
}

function clearColumnFilter(column) {
  delete columnFilters[column];
  filterTable();
  const dropdown = document.querySelector(`.filter-dropdown[data-column="${column}"]`);
  dropdown.style.display = "none";
  updateFilterHighlights(); // <-- add this line
}

function filterOptions(input) {
  const query = input.value.toLowerCase();
  const labels = input.parentElement.querySelectorAll("label");

  labels.forEach(label => {
    label.style.display = label.textContent.toLowerCase().includes(query) ? "block" : "none";
  });
}

function filterTable() {
  const rows = document.querySelectorAll("tbody tr");

  rows.forEach(row => {
    let visible = true;

    for (const [column, selectedValues] of Object.entries(columnFilters)) {
      const colIndex = getColumnIndex(column);
      const cellText = row.children[colIndex].textContent.trim();

      if (selectedValues.length > 0 && !selectedValues.includes(cellText)) {
        visible = false;
        break;
      }
    }

    row.style.display = visible ? "" : "none";
  });
   updateFilterHighlights(); // <-- add this line
}


// Prevent closing when clicking inside the dropdown
document.addEventListener('mousedown', function (e) {
  // Only close if the click is NOT inside any filter-dropdown or filter-icon
  if (!e.target.closest('.filter-dropdown') && !e.target.closest('.filter-icon')) {
    document.querySelectorAll('.filter-dropdown').forEach(drop => drop.style.display = 'none');
  }
});

function populateCheckboxOptions(column, dropdown) {
  const rows = document.querySelectorAll('tbody tr');
  const values = new Set();
  const colIndex = getColIndex(column);

  rows.forEach(row => {
    const cellValue = row.children[colIndex].textContent.trim();
    values.add(cellValue);
  });

  const list = dropdown.querySelector('.checkbox-list');
  list.innerHTML = '';

  // Add Select All checkbox
  list.innerHTML += `
    <label style="font-weight:600;">
      <input type="checkbox" id="selectAll_${column}" onchange="toggleSelectAll('${column}', this)">
      Select All
    </label>
  `;

  values.forEach(value => {
    const id = `${column}_${value.replace(/\s+/g, '_')}`;
    list.innerHTML += `
      <label>
        <input type="checkbox" value="${value}" onchange="applyInstantFilter('${column}')"> ${value}
      </label>`;
  });

  // Pre-check selected filters
  if (window.columnFilters && window.columnFilters[column]) {
    window.columnFilters[column].forEach(val => {
      const box = list.querySelector(`input[value="${val}"]`);
      if (box) box.checked = true;
    });
  }

  // Update Select All state
  //updateSelectAllCheckbox(column);
}


async function loadCompanyNames() {
  try {
    const res = await fetch('/api/company-names');
    const companyNames = await res.json();

    const datalist = document.getElementById('companyNameList');
    if (datalist) {
      datalist.innerHTML = '';
      companyNames.forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        datalist.appendChild(option);
      });
    }
  } catch (err) {
    console.error('Error loading company names:', err);
  }
}

window.onload = function() {
  loadCompanyNames();
};


function toggleSelectAll(column, selectAllBox) {
  const dropdown = document.querySelector(`.filter-dropdown[data-column="${column}"]`);
  const checkboxes = dropdown.querySelectorAll('.checkbox-list input[type="checkbox"]:not(#selectAll_' + column + ')');
  checkboxes.forEach(cb => cb.checked = selectAllBox.checked);
  applyInstantFilter(column);
}

function updateSelectAllCheckbox(column) {
  const dropdown = document.querySelector(`.filter-dropdown[data-column="${column}"]`);
  if (!dropdown) return;
  const allBoxes = dropdown.querySelectorAll('.checkbox-list input[type="checkbox"]:not(#selectAll_' + column + ')');
  const selectAllBox = dropdown.querySelector('#selectAll_' + column + '');
  if (!selectAllBox) return;
  const checkedCount = Array.from(allBoxes).filter(cb => cb.checked).length;
  selectAllBox.checked = checkedCount === allBoxes.length && allBoxes.length > 0;
  selectAllBox.indeterminate = checkedCount > 0 && checkedCount < allBoxes.length;
}

function filterOptions(input) {
  const search = input.value.toLowerCase();
  const checkboxes = input.parentElement.querySelectorAll('.checkbox-list label');

  checkboxes.forEach(label => {
    const text = label.textContent.toLowerCase();
    label.style.display = text.includes(search) ? 'block' : 'none';
  });
}

function addAnotherClient() {
  document.getElementById("successOverlay").style.display = "none";
  // Keep the form visible to add another client
}

function filterCompanyNameInput(input) {
  // Only allow: letters, numbers, space, . , & / - ( ) [ ] ; : '
  input.value = input.value.replace(/[^A-Za-z0-9 .,&\/\-\(\)\[\];:']/g, '');
}

function filterClientNameInput(input) {
  // Only allow letters and spaces
  input.value = input.value.replace(/[^A-Za-z ]/g, '');
}

function applyInstantFilter(column) {
  updateSelectAllCheckbox(column);
  const rows = document.querySelectorAll('tbody tr');
  let colIndex = getColIndex(column);

  const checked = Array.from(document.querySelectorAll(`.filter-dropdown[data-column="${column}"] input[type="checkbox"]:checked`))
    .map(cb => cb.value);

  rows.forEach(row => {
    let match = true;
    const cellValue = row.children[colIndex].textContent.trim();

    // List all columns you want to filter
    [
      'company_name',
      'client_name',
      'email',
      'phone',
      'billing_address',
      'gst_no',
      'pan',
      'client_id'
    ].forEach(col => {
      const idx = getColIndex(col);
      const otherChecked = Array.from(document.querySelectorAll(`.filter-dropdown[data-column="${col}"] input[type="checkbox"]:checked`))
        .map(cb => cb.value);
      if (otherChecked.length && !otherChecked.includes(row.children[idx].textContent.trim())) {
        match = false;
      }
    });
    updateFilterHighlights(); // <-- add 

    // For the current column, check if the value is in checked
    if (checked.length && !checked.includes(cellValue)) match = false;

    row.style.display = match ? '' : 'none';
  });
}

function goToDashboard() {
  window.location.href = "{{ url_for('dashboard') }}";
}

function addAnotherClient() {
  document.getElementById("successOverlay").style.display = "none";
  document.getElementById("add-client").style.display = "block";
  document.getElementById("client-list").style.display = "none";
}

function getColIndex(col) {
  switch (col) {
    case 'client_id': return 0;
    case 'company_name': return 1;
    case 'client_name': return 2;
    case 'email': return 3;
    case 'phone': return 4;
    case 'billing_address': return 5;
    case 'gst_no': return 6;
    case 'pan': return 7;
  }
}


document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.delete-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      // Only modal-based delete logic is used. No browser confirm popups.
      openClientDeleteModal(this);
    });
  });
});

document.getElementById("sortFieldSelect").addEventListener("change", function() {
  sortField = this.value;
  updateSortButtonLabel();
  sortClientTable();
});



// Toggle sort order (A-Z/Z-A) when clicking the main part of the button
document.getElementById("sortToggleBtn").addEventListener("click", function(event) {
  // If the click is on the arrow, show/hide dropdown
  if (event.target.closest('.sort-arrow')) {
    const dropdown = document.getElementById("sortFieldDropdown");
    dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
    event.stopPropagation();
    return;
  }
  // Otherwise, toggle sort order
  sortClientAZ = !sortClientAZ;
  updateSortButtonLabel();
  sortClientTable();
});

// Handle dropdown option click
document.querySelectorAll(".sort-field-option").forEach(opt => {
  opt.addEventListener("click", function() {
    sortField = this.getAttribute("data-value");
    updateSortButtonLabel();
    sortClientTable();
    document.getElementById("sortFieldDropdown").style.display = "none";
  });
});

// Hide dropdown when clicking outside
document.addEventListener("click", function(e) {
  const dropdown = document.getElementById("sortFieldDropdown");
  if (dropdown && !dropdown.contains(e.target) && !document.getElementById("sortToggleBtn").contains(e.target)) {
    dropdown.style.display = "none";
  }
});

updateSortButtonLabel();

sortClientTable();
</script>
<div id="editModal" class="modall-overlay" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <i class="fas fa-edit modal-icon"></i>
    </div>
    <div class="modal-body">
      <h3>Update client details and save your changes.</h3>

      <!-- ‚úÖ Wrap everything in a form -->
      <form id="editForm" onsubmit="submitEdit(event)">
  <input type="hidden" id="editOrderId">

  <div class="form-row">
    <!-- Example for Edit Modal -->
<div class="form-group">
  <label>Company Name</label>
  <input type="text" id="editCompany" required
  pattern="[A-Za-z0-9 .,&/\-\(\)\[\];:']{2,100}"
  title="Only letters, numbers, spaces, and . , & / - ( ) [ ] ; : ' allowed. 2‚Äì100 characters."
  oninput="filterCompanyNameInput(this); validateField(this)">
<span class="error-message" id="editCompany_error"></span>
</div>
    
</div>
    <div class="form-group">
      <label>Client Name</label>
      <input type="text" id="editClient" required
  pattern="[A-Za-z' ]{1,100}"
  title="Only letters and spaces allowed. 1‚Äì100 characters."
  oninput="filterClientNameInput(this); validateField(this)">
<span class="error-message" id="editClient_error" style="color: red; font-size: 13px;"></span>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>Email</label>
     <input type="email" id="editEmail" name="editEmail" required
  pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
  title="Enter a valid email address"
  oninput="validateEditEmail(this)">
<span class="error-message" id="editEmail_error"></span>

    </div>
    <div class="form-group">
      <label>Phone</label>
      <input type="text" id="editPhone" required pattern="[0-9]{10}" maxlength="10" title="Enter a valid 10-digit phone number">
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>GST No</label>
      <input type="text" id="editGST" required
        pattern="\d{2}[A-Z]{5}\d{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}"
        title="Enter valid GST No (e.g., 22AAAAA0000A1Z5)">
    </div>
    <div class="form-group">
      <label>PAN</label>
      <input type="text" id="editPAN" required pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" maxlength="10" title="Enter valid PAN (e.g., ABCDE1234F)">
    </div>
  </div>

  <div class="form-group">
    <label>Billing Address</label>
    <textarea id="editBillingAddress" rows="3" required></textarea>
  </div>

  <div class="modal-footer">
    <button type="button" onclick="closeEditModal()" class="cancel-btn">Cancel</button>
    <button type="submit" class="save-btn">Save</button>
  </div>
</form>
    </div>
  </div>
</div>


<!-- Delete Confirmation Modal (Styled like Image) -->
<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="delete-modal-overlay" style="display: none;">
  <div class="delete-modal-box">
    <div class="delete-icon-container">
      <i class="fas fa-trash"></i>
    </div>
    <div class="delete-modal-body">
      <h2>Are you sure you want to delete this Client?</h2>
      <table class="delete-details-table">
        <tr>
          <td><strong>Client ID:</strong></td>
          <td id="modalClientId"></td>
        </tr>
        <tr>
          <td><strong>Company Name:</strong></td>
          <td id="modalCompanyName"></td>
        </tr>
        <tr>
          <td><strong>Client Name:</strong></td>
          <td id="modalClientName"></td>
        </tr>
      </table>
      <div class="delete-modal-actions">
        <button class="cancel-btn" onclick="closeDeleteModal()">Cancel</button>
        <button class="delete-btn" onclick="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>
</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<div id="successOverlay" style="display: none;" class="overlay-success">
<div class="success-card">
  <div class="success-icon">
    <i class="fas fa-check-circle"></i>
  </div>
  <h2>Client Added Successfully!</h2>
  <p class="success-id-label">Client ID: <span id="success-client-id"></span></p>

  <div class="success-actions">
    <button onclick="goToDashboard()" class="btn-success">Back to Dashboard</button>
    <button onclick="addAnotherClient()" class="btn-outline">Add More Clients</button>
  </div>
</div>

</div>
<div id="duplicateOverlay" style="display: none;" class="overlay-success">
  <div class="success-card">
    <div class="success-icon" style="color: #ff9800;">
      <i class="fas fa-exclamation-circle"></i>
    </div>
    <h2>Client Already Exists!</h2>
    <p class="success-id-label">A client with this email is already added.</p>

    <div class="success-actions">
      <button onclick="closeDuplicateOverlay()" class="btn-outline">Back to Add Client</button>
    </div>
  </div>
</div>


<!-- FIX: REMOVED all redundant/conflicting delete modal HTML and scripts -->

<script>
// A single, clean set of functions to handle client deletion
let clientToDeleteId = null;

function openDeleteModal(button) {
  const row = button.closest("tr");
  clientToDeleteId = row.getAttribute("data-client-id");

  // Get text content for the modal display
  const clientId = row.children[0].textContent.trim();
  const companyName = row.children[1].textContent.trim();
  const clientName = row.children[2].textContent.trim();
  
  // Populate the modal with the correct client info
  document.getElementById("modalClientId").textContent = clientId;
  document.getElementById("modalCompanyName").textContent = companyName;
  document.getElementById("modalClientName").textContent = clientName;
  
  // Show the modal
  document.getElementById("deleteModal").style.display = "flex";
}

function closeDeleteModal() {
  document.getElementById("deleteModal").style.display = "none";
  clientToDeleteId = null; // Reset the ID when closing
}

function confirmDelete() {
  if (!clientToDeleteId) return; // Safety check

  fetch(`/delete-client/${clientToDeleteId}`, {
    method: "DELETE",
    credentials: 'same-origin'
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      const row = document.querySelector(`tr[data-client-id="${clientToDeleteId}"]`);
      if (row) {
        row.remove(); // Remove the row from the table on success
      }
      closeDeleteModal(); // Close the modal
    } else {
      // Handle potential errors if needed, though the prompt asked to ignore them
      console.error("Delete failed:", data.error);
      closeDeleteModal();
    }
  })
  .catch(err => {
    console.error("Server error:", err);
    closeDeleteModal();
  });
}

// Session management scripts
setInterval(() => {
  fetch("/api/ping", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ page: window.location.pathname })
  });
}, 30000); // every 30 seconds

setInterval(() => {
  fetch('/api/check-session')
    .then(res => res.json())
    .then(data => {
      if (!data.valid) {
        window.location.href = '/logout';
      }
    })
    .catch(err => {
      console.error("Session check error:", err);
    });
}, 2000); // every 2 seconds

// Email validation for the edit form
function validateEditEmail(input) {
  const pattern = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/i;
  const errorSpan = document.getElementById("editEmail_error");

  if (!input.value.trim()) {
    input.setCustomValidity("Email is required.");
    errorSpan.textContent = "Email is required.";
    errorSpan.style.display = "block";
  } else if (!pattern.test(input.value.trim())) {
    input.setCustomValidity("Enter a valid email address.");
    errorSpan.textContent = "Enter a valid email address.";
    errorSpan.style.display = "block";
  } else {
    input.setCustomValidity("");
    errorSpan.textContent = "";
    errorSpan.style.display = "none";
  }
}

</script>

</body>
</html>